doctype html
html(lang="es")
  head
    meta(charset="utf-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title Sarumed - Sistema de GestiÃ³n MÃ©dica

    link(rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.dataTables.min.css")
    link(rel='stylesheet', href='/stylesheets/style.css')

    script(src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.15/index.global.min.js")
    script(src="https://cdn.jsdelivr.net/npm/@fullcalendar/web-component@6.1.15/index.global.min.js")
    script(src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.15/index.global.min.js")

    block scripts

    style.
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background: #f5f7fa;
        color: #1a202c;
      }

      header.main-header{
        position: sticky;
        top: 0;
        z-index: 20;
        background: white;
        border-bottom: 1px solid #e2e8f0;
        padding: 0.85rem 1.5rem;

        display: grid;
        grid-template-columns: auto 1fr auto;
        align-items: center;
        gap: 1rem;
      }

      .logo {
        font-size: 1.5rem;
        font-weight: 800;
        color: #2d3748;
        white-space: nowrap;
      }

      .role-nav{
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.6rem;
        flex-wrap: wrap;
      }

      .role-link{
        text-decoration: none;
        color: #4a5568;
        font-weight: 700;
        font-size: 0.92rem;
        padding: 0.5rem 0.9rem;
        border-radius: 999px;
        border: 1px solid transparent;
        background: #edf2f7;
        transition: transform .15s, box-shadow .15s, background .15s, color .15s, border-color .15s;
        display: inline-flex;
        align-items: center;
        gap: .5rem;
      }

      .role-link:hover{
        transform: translateY(-1px);
        background: #e6f2ff;
        border-color: #bee3f8;
        box-shadow: 0 6px 16px rgba(43,108,176,0.12);
      }

      .role-link.active{
        color: #1a365d;
        background: #e6f2ff;
        border-color: #90cdf4;
        box-shadow: 0 0 0 3px rgba(66,153,225,0.18), 0 10px 22px rgba(43,108,176,0.18);
      }

      .header-right{
        display: flex;
        align-items: center;
        gap: 1rem;
        white-space: nowrap;
      }

      .user-info {
        display: flex;
        flex-direction: column;
        padding: 0.45rem 0.75rem;
        background: #edf2f7;
        border-radius: 8px;
        line-height: 1.1;
      }

      .user-info span:first-child{
        font-weight: 700;
        color: #2d3748;
        font-size: 0.9rem;
      }

      .user-role {
        font-size: 0.8rem;
        color: #718096;
        font-weight: 600;
      }

      .header-right a{
        color: #4a5568;
        text-decoration: none;
        font-weight: 700;
        transition: color 0.2s;
      }

      .header-right a:hover{
        color: #2b6cb0;
      }

      .logout{
        color: #c53030 !important;
      }

      .logout:hover{
        text-decoration: underline;
      }

      main {
        max-width: 1600px;
        margin: 0 auto;
        padding: 2rem;
      }

      /* ===== MOBILE ===== */
      @media (max-width: 900px) {
        header.main-header{
          grid-template-columns: 1fr;
          gap: 0.75rem;
          padding: 1rem;
        }

        .logo{
          text-align: center;
        }

        .header-right{
          justify-content: center;
        }

        .role-link{
          width: 100%;
          justify-content: center;
        }

        main {
          padding: 1rem;
        }
      }

  body
    header.main-header
      .logo Sarumed

      if user
        nav.role-nav
          - const p = currentPath || ''
          - const isActive = (prefix) => p === prefix || p.startsWith(prefix + '/')

          if user.rol === 'secretaria'
            a.role-link(class=isActive('/turno/listar') ? 'active' : '', href="/turno/listar") ğŸ“… Turnos
            a.role-link(class=isActive('/paciente/lista') ? 'active' : '', href="/paciente/lista") ğŸ§‘â€âš•ï¸ Pacientes
            a.role-link(class=isActive('/paciente/nuevo') ? 'active' : '', href="/paciente/nuevo") â• Nuevo paciente
            a.role-link(class=isActive('/paciente/personas') ? 'active' : '', href="/paciente/personas") ğŸªª Asignar rol

          if user.rol === 'admin'
            a.role-link(class=isActive('/medico/lista') ? 'active' : '', href="/medico/lista") ğŸ©º MÃ©dicos
            a.role-link(class=isActive('/medico/nuevo') ? 'active' : '', href="/medico/nuevo") â• Nuevo mÃ©dico
            a.role-link(class=isActive('/medico/personas') ? 'active' : '', href="/medico/personas") ğŸªª Asignar rol
            a.role-link(class=isActive('/dia_no_laborales/lista') ? 'active' : '', href="/dia_no_laborales/lista") ğŸš« DÃ­as no laborables

          if user.rol === 'paciente'
            a.role-link(class=isActive('/turno/mis-turnos') ? 'active' : '', href="/turno/mis-turnos") âœ… Mis turnos
            a.role-link(class=isActive('/turno/solicitar') ? 'active' : '', href="/turno/solicitar") ğŸ“ Solicitar
            a.role-link(class=isActive('/historia-clinica') ? 'active' : '', href="/historia-clinica") ğŸ“„ Historia clÃ­nica
            a.role-link(class=isActive('/perfil') ? 'active' : '', href="/perfil") ğŸ‘¤ Perfil

      .header-right
        if user
          .user-info
            span #{user.nombre || 'Usuario'}
            span.user-role (#{user.rol || 'Usuario'})
          a.logout(href="/usuario/logout") Cerrar SesiÃ³n

    main
      block content
