extends ../layout

block content
  .register-doctor-container
    h1.page-title Registrar Médico

    form#formMedico.register-form(method="POST" action="/medico")
      h2.form-section-title Datos de la Persona
      .form-grid
        .form-group
          label(for="nombre") Nombre:
          input(type="text" name="nombre" id="nombre" required)
        .form-group
          label(for="apellido") Apellido:
          input(type="text" name="apellido" id="apellido" required)
        .form-group
          label(for="dni") DNI:
          input(type="text" name="dni" id="dni" required pattern="\\d{8}" title="El DNI debe contener 8 dígitos")
        .form-group
          label(for="mail") Email:
          input(type="email" name="mail" id="mail" required)
        .form-group
          label(for="telefono") Teléfono:
          input(type="tel" name="telefono" id="telefono" required pattern="\\d{10}" title="El teléfono debe contener 10 dígitos")

      .form-actions
        button(type="submit" id="AgregarMedico") Registrar Médico
        a.login-link(href="/login") ¿Ya tienes una cuenta?

block scripts
  script.
    document.addEventListener('DOMContentLoaded', () => {
      const formMedico = document.getElementById('formMedico');

      formMedico.addEventListener('submit', async (event) => {
        event.preventDefault();

        const formData = new FormData(formMedico);
        const formProps = Object.fromEntries(formData);

        // Validación de campos
        for (const [key, value] of Object.entries(formProps)) {
          if (!value.trim()) {
            showAlert(`El campo ${key} es obligatorio.`, 'error');
            return;
          }
        }

        // Validación de formato de email
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailPattern.test(formProps.mail)) {
          showAlert('Por favor ingresa un email válido.', 'error');
          return;
        }

        try {
          const response = await fetch('/medico', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              ...formProps,
              nombre: formProps.nombre.trim().toUpperCase(),
              apellido: formProps.apellido.trim().toUpperCase(),
            }),
          });

          if (response.ok) {
            formMedico.reset();
            showAlert('Médico registrado exitosamente', 'success');
          } else {
            const errorData = await response.json();
            showAlert('Error al registrar el médico: ' + (errorData.message || 'Error desconocido'), 'error');
          }
        } catch (error) {
          console.error('Error al enviar el formulario:', error);
          showAlert('Error al enviar el formulario.', 'error');
        }
      });

      function showAlert(message, type) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type}`;
        alertDiv.textContent = message;
        document.querySelector('.register-doctor-container').prepend(alertDiv);
        setTimeout(() => alertDiv.remove(), 5000);
      }
    });

  block styles
    style.
      .register-doctor-container {
        max-width: 600px;
        margin: 2rem auto;
        padding: 2rem;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .page-title {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 2rem;
        font-size: 2rem;
        font-weight: 600;
      }

      .form-section-title {
        color: #34495e;
        margin-bottom: 1.5rem;
        font-size: 1.2rem;
        font-weight: 500;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #2c3e50;
      }

      .form-group input {
        width: 100%;
        padding: 0.75rem;
        font-size: 1rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
      }

      .form-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 2rem;
      }

      #AgregarMedico {
        background-color: #3498db;
        color: white;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 4px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      #AgregarMedico:hover {
        background-color: #2980b9;
      }

      .login-link {
        color: #3498db;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s ease;
      }

      .login-link:hover {
        color: #2980b9;
      }

      .alert {
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 4px;
        font-weight: 500;
      }

      .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .alert-error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      @media (max-width: 600px) {
        .register-doctor-container {
          margin: 1rem;
          padding: 1rem;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .form-actions {
          flex-direction: column;
          gap: 1rem;
        }

        #AgregarMedico {
          width: 100%;
        }
      }