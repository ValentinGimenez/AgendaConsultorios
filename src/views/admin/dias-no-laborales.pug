extends ../layout.pug
append styles
  link(rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css")

append scripts
  script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js")

block content
  .dias-container
    .dias-card
      h1.dias-title Días No Laborables

      .dias-grid
        .dias-form-section
          h2.dias-section-title(id="formTitle") Nuevo Día No Laboral

          form#diaForm.dias-form
            input(type="hidden" id="diaId")
            .form-group
              label(for="tipo") Tipo
              select#tipo(name="tipo" required)
                option(value="FERIADO") Feriado
                option(value="VACACIONES") Vacaciones 
                option(value="AUSENCIA") Ausencia
            .form-group 
              label(for="alcance") Alcance
              select#alcance(name="alcance" required)
                option(value="GLOBAL") Todos
                option(value="PROFESIONAL") Profesional específico
                option(value="SUCURSAL") Sucursal específica
            .form-group#groupMedico(style="display:none")
              label(for="idMedico") Médico
              select#idMedico(name="idMedico")
                option(value="") Seleccionar médico
                each m in medicos
                  option(value=m.medico_id) #{m.nombre   + ' ' + m.apellido}
            .form-group#groupSucursal(style="display:none")
              label(for="idSucursal") Sucursal
              select#idSucursal(name="idSucursal")
                option(value="") Seleccionar sucursal
                each s in sucursales
                  option(value=s.ID) #{s.nombre}
            .form-group 
              label(for="fecha_inicio") Fecha inicio
              input#fecha_inicio(type="date" name="fecha_inicio" required)
            .form-group 
              label(for="fecha_fin") Fecha fin
              input#fecha_fin(type="date" name="fecha_fin" required)
            .form-group
              div.radio-group
                label.radio-label
                  input(type="radio" name="all_day" value="1" checked)
                  span Todo el día
                label.radio-label
                  input(type="radio" name="all_day" value="0")
                  span Rango horario
            .form-group#rangoHorario(style="display:none")
              label(for="hora_inicio") Hora inicio
              input#hora_inicio(type="time" name="hora_inicio" )
              label(for="hora_fin") Hora fin
              input#hora_fin(type="time" name="hora_fin")
            .form-group
              label(for="descripcion") Motivo
              input.dias-input(type="text" id="descripcion" name="descripcion" placeholder="Ej: Feriado nacional" required)
            .form-actions
              button#btnGuardar(type="submit" class="btn-primary") Guardar
              button#btnCancelar(type="button" class="btn-secondary" style="display:none") Cancelar edición

        .dias-list-section
          h2.dias-section-title Listado

          if dias && dias.length
            .table-responsive
              table.dias-table
                thead
                  tr
                    th ID
                    th Fecha
                    th Motivo
                    th Tipo
                    th Aplica a
                    th Acciones
                tbody
                  each dia in dias
                    - const m = dia.idMedico ? medicos.find(x => Number(x.medico_id) === Number(dia.idMedico)) : null
                    - const s = dia.idSucursal ? sucursales.find(x => Number(x.ID || x.id) === Number(dia.idSucursal)) : null
                    - const aplicaA = m ? `Dr.  ${(m.nombre + ' ' + m.apellido)}` : (s ? `Sucursal: ${s.nombre}` : 'Todas las sucursales')
                    - let alcance = 'GLOBAL'
                    - if (dia.idMedico)
                      - alcance = 'PROFESIONAL'
                    - else if (dia.idSucursal)
                      - alcance = 'SUCURSAL'
                    tr(
                      data-id=dia.ID
                      data-fechainicio= new Date(dia.fecha_inicio).toISOString().slice(0,10)
                      data-fechafin= new Date(dia.fecha_fin).toISOString().slice(0,10)
                      data-descripcion = dia.descripcion
                      data-tipo= dia.tipo
                      data-alcance=alcance
                      data-idmedico=dia.idMedico
                      data-idsucursal=dia.idSucursal
                      data-allday=dia.all_day
                      data-horainicio=dia.hora_inicio
                      data-horafin=dia.hora_fin
                    )
                      td= dia.ID
                      td= new Date(dia.fecha_inicio).toISOString().slice(0,10)
                      td= dia.descripcion
                      td
                        span.badge(class=`badge-${dia.tipo}`)= dia.tipo
                      td= aplicaA
                      td.dias-actions
                        button.action-btn.edit-btn(type="button" data-action="edit" title="Editar")
                          svg(xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round")
                            path(d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7")
                            path(d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z")
                        button.action-btn.delete-btn(type="button" data-action="delete" title="Eliminar")
                           svg(xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round")
                             polyline(points="3 6 5 6 21 6")
                             path(d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2")
          else
            p.dias-empty No hay días no laborables cargados.

  div.modal.fade#modalTurnosAfectados(tabindex='-1' aria-hidden='true')
    div.modal-dialog.modal-lg.modal-dialog-centered
     div.modal-content
      div.modal-header
        h5.modal-title Turnos afectados por día no laboral
        button.btn-close(type='button' data-bs-dismiss='modal' aria-label='Close')

      div.modal-body
        p#msgTurnosAfectados.mb-2
        div.alert.alert-info.py-2.mb-3
          small
            | Podés enviar estos turnos a lista de espera para que Secretaría los reasigne.

        div.table-responsive
          table.table.table-sm.align-middle
            thead
              tr
                th Paciente
                th Fecha
                th Horario
                th Sucursal
            tbody#tablaTurnosAfectados
              tr
                td(colspan='6') Cargando...

      div.modal-footer
        button.btn.btn-primary#btnEnviarEspera(type='button') Enviar a lista de espera

  script.
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('diaForm');

      const inputId = document.getElementById('diaId');

      const selectTipo = document.getElementById('tipo');
      const selectAlcance = document.getElementById('alcance');

      const groupMedico = document.getElementById('groupMedico');
      const groupSucursal = document.getElementById('groupSucursal');

      const selectMedico = document.getElementById('idMedico');
      const selectSucursal = document.getElementById('idSucursal');

      const inputFechaInicio = document.getElementById('fecha_inicio');
      const inputFechaFin = document.getElementById('fecha_fin');

      const rangoHorario = document.getElementById('rangoHorario');
      const inputHoraInicio = document.getElementById('hora_inicio');
      const inputHoraFin = document.getElementById('hora_fin');

      const inputDescripcion = document.getElementById('descripcion');

      const formTitle = document.getElementById('formTitle');
      const btnGuardar = document.getElementById('btnGuardar');
      const btnCancelar = document.getElementById('btnCancelar');

      const hoy = new Date().toISOString().split('T')[0];
      inputFechaInicio.min = hoy;
      inputFechaFin.min = hoy;

      let editingId = null;

      function getAllDayValue() {
        const checked = document.querySelector('input[name="all_day"]:checked');
        return checked ? checked.value : '1';
      }

      function refreshAlcanceUI(preserve=false) {
        const a = selectAlcance.value;

        groupMedico.style.display = (a === 'PROFESIONAL') ? 'block' : 'none';
        groupSucursal.style.display = (a === 'SUCURSAL') ? 'block' : 'none';

        if (!preserve) {
          if (a !== 'PROFESIONAL') selectMedico.value = '';
          if (a !== 'SUCURSAL') selectSucursal.value = '';
        }
      }

      function refreshHorasUI(preserve=false) {
        const allDay = getAllDayValue();
        rangoHorario.style.display = (allDay === '0') ? 'block' : 'none';

        if (!preserve && allDay === '1') {
          inputHoraInicio.value = '';
          inputHoraFin.value = '';
        }
      }

          selectAlcance.addEventListener('change', () => refreshAlcanceUI(false));
            document.querySelectorAll('input[name="all_day"]').forEach(r => {
            r.addEventListener('change', () => refreshHorasUI(false));
          });
      selectMedico.addEventListener('change', () => {
        resolverBloquesAusencia().catch(e => showAlert(e.message, 'error'));
      });

      inputFechaInicio.addEventListener('change', () => {
        resolverBloquesAusencia().catch(e => showAlert(e.message, 'error'));
      });

      document.querySelectorAll('input[name="all_day"]').forEach(r => {
        r.addEventListener('change', () => {
          refreshHorasUI(false);
          resolverBloquesAusencia().catch(e => showAlert(e.message, 'error'));
        });
      });

      inputHoraInicio.addEventListener('change', () => {
        resolverBloquesAusencia().catch(e => showAlert(e.message, 'error'));
      });
      inputHoraFin.addEventListener('change', () => {
        resolverBloquesAusencia().catch(e => showAlert(e.message, 'error'));
      });

      selectTipo.addEventListener('change', () => {
        limpiarBloquesUI();
        resolverBloquesAusencia().catch(() => {});
      });
      selectAlcance.addEventListener('change', () => {
        limpiarBloquesUI();
        resolverBloquesAusencia().catch(() => {});
      });

          const inputBloquesJson = document.getElementById('bloquesJson');
    const groupBloques = document.getElementById('groupBloques');
    const listaBloques = document.getElementById('listaBloques');

    let bloquesResueltos = []; 

    function limpiarBloquesUI() {
      bloquesResueltos = [];
      if (inputBloquesJson) inputBloquesJson.value = '';
      if (groupBloques) groupBloques.style.display = 'none';
      if (listaBloques) listaBloques.innerHTML = '';
    }

    function renderBloquesUI(bloques) {
      if (!groupBloques || !listaBloques) return;
      listaBloques.innerHTML = '';

      if (!bloques || bloques.length === 0) {
        groupBloques.style.display = 'none';
        return;
      }

      for (const b of bloques) {
        const li = document.createElement('li');
        li.textContent = `Agenda #${b.idAgenda} | Sucursal #${b.idSucursal} | ${b.hora_inicio}–${b.hora_fin}`;
        listaBloques.appendChild(li);
      }
      groupBloques.style.display = 'block';
    }

    async function resolverBloquesAusencia() {
      limpiarBloquesUI();

      const tipo = selectTipo.value;
      const alcance = selectAlcance.value;

      if (tipo !== 'AUSENCIA' || alcance !== 'PROFESIONAL') return;

      const idMedico = Number(selectMedico.value || 0);
      const fecha = inputFechaInicio.value; 
      if (!idMedico || !fecha) return;

      const all_day = getAllDayValue();
      let hora_inicio = null;
      let hora_fin = null;

      if (all_day === '0') {
        hora_inicio = (inputHoraInicio.value || '').slice(0,5);
        hora_fin = (inputHoraFin.value || '').slice(0,5);
        if (!hora_inicio || !hora_fin || hora_fin <= hora_inicio) return;
      }

      const resp = await fetch('/dia_no_laborales/resolver-bloques-ausencia', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          idMedico,
          fecha,
          all_day: Number(all_day),
          hora_inicio,
          hora_fin
        })
      });

      const data = await resp.json().catch(() => ({}));
      if (!resp.ok) {
        throw new Error(data.message || 'Error resolviendo bloques de ausencia');
      }

      bloquesResueltos = Array.isArray(data.bloques) ? data.bloques : [];
      if (inputBloquesJson) inputBloquesJson.value = JSON.stringify(bloquesResueltos);

      renderBloquesUI(bloquesResueltos);

      if (bloquesResueltos.length === 1) {
        const sId = String(bloquesResueltos[0].idSucursal);
        selectSucursal.value = sId;
      }
    }



      refreshAlcanceUI();
      refreshHorasUI();

      let payloadPendiente = null;
      let requestPendiente = null;
      


      async function verificarTurnos(payload, isEditing, editingId) {
        const resp = await fetch('/dia_no_laborales/verificar-turnos', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            ...payload,
            excludeDiaId: isEditing ? Number(editingId) : null
          })
        });

        const data = await resp.json().catch(() => ({}));
        if (!resp.ok) throw new Error(data.message || 'Error verificando turnos');
        return data; 
      }

      function renderTablaTurnos(turnos) {
        const tbody = document.getElementById('tablaTurnosAfectados');
        tbody.innerHTML = '';

        if (!turnos || turnos.length === 0) {
          tbody.innerHTML = `<tr><td colspan="6">Sin turnos</td></tr>`;
          return;
        }

          console.log(turnos);
        for (const t of turnos) {
          const tr = document.createElement('tr');
          const fecha = (t.fecha || t.fecha_turno || '').toString().slice(0,10);

          tr.innerHTML = `
            <td>${t.paciente || '-'}</td>
            <td>${fecha || '-'}</td>
            <td>${(t.hora_inicio || t.hora || '-')}${t.hora_fin ? '–' + t.hora_fin : ''}</td>
            <td>${t.sucursal || '-'}</td>
          `;
          tbody.appendChild(tr);
        }
      }

      function abrirModalTurnos({ count, turnos }, payload) {
        document.getElementById('msgTurnosAfectados').textContent =
          `Se detectaron ${count} turnos reservados/confirmados dentro del rango ${payload.fecha_inicio} → ${payload.fecha_fin}.`;

        renderTablaTurnos(turnos);

        const modalEl = document.getElementById('modalTurnosAfectados');
        const modal = new bootstrap.Modal(modalEl);
        modal.show();
      }

        async function guardarConAccion(accionTurnos) {
          const { url, method } = requestPendiente;

          const resp = await fetch(url, {
            method,
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              ...payloadPendiente,
              accion_turnos: accionTurnos
            })
          });

          const data = await resp.json().catch(() => ({}));
          if (!resp.ok) throw new Error(data.message || 'Error al guardar');

          showAlert(data.message || 'Guardado.', 'success');
          document.activeElement?.blur();
          setTimeout(() => window.location.reload(), 800);
        }



      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const tipo = selectTipo.value;
        const alcance = selectAlcance.value;

        const fecha_inicio = inputFechaInicio.value;
        const fecha_fin = inputFechaFin.value;

        const all_day = getAllDayValue(); 
        const hora_inicio = inputHoraInicio.value;
        const hora_fin = inputHoraFin.value;

        const descripcion = (inputDescripcion.value || '').trim();

        if (!tipo || !alcance) {
          showAlert('Seleccione tipo y alcance.', 'error');
          return;
        }

        if (!fecha_inicio || !fecha_fin) {
          showAlert('Seleccione fecha inicio y fecha fin.', 'error');
          return;
        }

        if (new Date(fecha_fin) < new Date(fecha_inicio)) {
          showAlert('La fecha fin no puede ser menor que la fecha inicio.', 'error');
          return;
        }

        if (!descripcion) {
          showAlert('El motivo/descripcion es obligatorio.', 'error');
          return;
        }

        let idMedico = null;
        let idSucursal = null;

        if (alcance === 'PROFESIONAL') {
          if (!selectMedico.value) {
            showAlert('Seleccione un médico.', 'error');
            return;
          }
          idMedico = Number(selectMedico.value);
        }

        if (alcance === 'SUCURSAL') {
          if (!selectSucursal.value) {
            showAlert('Seleccione una sucursal.', 'error');
            return;
          }
          idSucursal = Number(selectSucursal.value);
        }

        let horaInicioToSend = null;
        let horaFinToSend = null;

        if (all_day === '0') {
          if (!hora_inicio || !hora_fin) {
            showAlert('Complete hora inicio y hora fin o marque "Todo el día".', 'error');
            return;
          }
          if (hora_fin <= hora_inicio) {
            showAlert('La hora fin debe ser mayor a la hora inicio.', 'error');
            return;
          }
          horaInicioToSend = hora_inicio;
          horaFinToSend = hora_fin;
        }
          console.log("fecha_inicio input:", inputFechaInicio);
          console.log("fecha_inicio value:", inputFechaInicio?.value);
          console.log("fecha_fin value:", inputFechaFin?.value);
          console.log("idMedico: ", idMedico);

          if (tipo === 'AUSENCIA' && alcance === 'PROFESIONAL') {
            if (!bloquesResueltos || bloquesResueltos.length === 0) {
              showAlert('No se pudo determinar en qué agendas aplica la ausencia (no hay horarios en ese rango).', 'error');
              return;
            }
          }
        const payload = {
          tipo,
          alcance,
          idMedico,     
          idSucursal,  
          fecha_inicio,
          fecha_fin,
          all_day: Number(all_day), 
          hora_inicio: horaInicioToSend,
          hora_fin: horaFinToSend,
          descripcion,
          bloques: bloquesResueltos
        };
          console.log("PAYLOAD FINAL:", payload);

               try {
          const isEditing = !!editingId;
          const url = isEditing
            ? `/dia_no_laborales/actualizarDiaNoLaboral/${editingId}`
            : '/dia_no_laborales/crearDiaNoLaboral';

          const method = isEditing ? 'PUT' : 'POST';

          payloadPendiente = payload;
          requestPendiente = { url, method };

          const ver = await verificarTurnos(payload, isEditing, editingId);

          if (ver.count > 0) {
            abrirModalTurnos(ver, payload);
            return;
          }

          await guardarConAccion("NINGUNA");

        } catch (error) {
          console.error(error);
          showAlert(error.message || 'Error al procesar la solicitud.', 'error');
        }
      });

      
      btnCancelar.addEventListener('click', () => {
        editingId = null;
        inputId.value = '';
        selectAlcance.disabled = false;
        selectMedico.disabled = false;
        selectSucursal.disabled = false;

        inputFechaInicio.min = hoy;
        inputFechaFin.min = hoy;


        form.reset();

  
        formTitle.textContent = 'Nuevo Día No Laboral';
        btnGuardar.textContent = 'Guardar';
        btnCancelar.style.display = 'none';

        refreshAlcanceUI();
        refreshHorasUI();
      });

    
      document.querySelectorAll('tbody tr').forEach(row => {
        const id = row.dataset.id;

        row.querySelectorAll('button').forEach(btn => {
          const action = btn.dataset.action;

          if (action === 'edit') {
            btn.addEventListener('click', () => {
              editingId = id;
              inputId.value = id;

              inputFechaInicio.min = '';
              inputFechaFin.min = '';

              const tipo = row.dataset.tipo || 'FERIADO';
              const alcanceOriginal = inferAlcanceFromRow(row);
              selectTipo.value = tipo;
              selectAlcance.value = alcanceOriginal;

              refreshAlcanceUI(true);

              selectAlcance.disabled = true;
              selectMedico.value = row.dataset.idmedico || '';
              selectSucursal.value = row.dataset.idsucursal || '';

              inputFechaInicio.value = row.dataset.fechainicio || '';
              inputFechaFin.value = row.dataset.fechafin || '';

              const allDay = (row.dataset.allday || '1').toString();
              const radio = document.querySelector(`input[name="all_day"][value="${allDay}"]`);
              if (radio) radio.checked = true;

              refreshHorasUI(true);
              
              if (allDay === '0') {
                inputHoraInicio.value = row.dataset.horainicio || '';
                inputHoraFin.value = row.dataset.horafin || '';
              } else {
                inputHoraInicio.value = '';
                inputHoraFin.value = '';
              }

              inputDescripcion.value = row.dataset.descripcion || '';

              formTitle.textContent = 'Editar registro';
              btnGuardar.textContent = 'Guardar cambios';
              btnCancelar.style.display = 'inline-block';
              window.scrollTo({ top: 0, behavior: 'smooth' });
            });
          }

          if (action === 'delete') {
            btn.addEventListener('click', async () => {
              if (!confirm('¿Seguro que deseas eliminar este registro?')) return;

              try {
                const response = await fetch(`/dia_no_laborales/eliminarDiaNoLaboral/${id}`, {
                  method: 'DELETE'
                });

                const data = await response.json().catch(() => ({}));

                if (!response.ok) {
                  showAlert(data.message || 'Error al eliminar.', 'error');
                  return;
                }

                showAlert(data.message || 'Registro eliminado.', 'success');
                row.remove();

                if (!document.querySelector('tbody tr')) {
                  const listSection = document.querySelector('.dias-list-section');
                  const emptyMsg = document.createElement('p');
                  emptyMsg.className = 'dias-empty';
                  emptyMsg.textContent = 'No hay días no laborables cargados.';
                  listSection.appendChild(emptyMsg);
                }

              } catch (error) {
                console.error(error);
                showAlert('Error al eliminar.', 'error');
              }
            });
          }
        });
      });

      function showAlert(message, type) {
        let existing = document.querySelector('.dias-alert');
        if (existing) existing.remove();

        const alertDiv = document.createElement('div');
        alertDiv.className = `dias-alert dias-alert-${type}`;
        alertDiv.textContent = message;

        document.querySelector('.dias-card').prepend(alertDiv);
        setTimeout(() => alertDiv.remove(), 4000);
      }
      function inferAlcanceFromRow(row) {
        const idMedico = (row.dataset.idmedico || '').trim();
        const idSucursal = (row.dataset.idsucursal || '').trim();

        if (idMedico) return 'PROFESIONAL';
        if (idSucursal) return 'SUCURSAL';
        return 'GLOBAL';
      }
    document.getElementById('btnEnviarEspera')?.addEventListener('click', async () => {
      try {
        await guardarConAccion("ESPERA");
      } catch (e) {
        showAlert(e.message || 'Error', 'error');
      }
    });

    document.getElementById('btnCancelarTurnos')?.addEventListener('click', async () => {
      try {
        await guardarConAccion("CANCELAR");
      } catch (e) {
        showAlert(e.message || 'Error', 'error');
      }
    });

    });
  
  style.
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

    :root {
      --primary: #3182ce;
      --primary-hover: #2c5282;
      --bg-page: #f3f4f6;
      --bg-card: #ffffff;
      --text-main: #1f2937;
      --text-muted: #6b7280;
      --border: #e2e8f0;
      --input-border: #cbd5e0;
      --radius: 0.75rem;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    body {
      background-color: var(--bg-page) !important;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color: var(--text-main);
    }

    .dias-container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    }

    .dias-card {
      background: var(--bg-card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 2.5rem;
      border: 1px solid var(--border);
    }

    .dias-title {
      text-align: center;
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 2rem;
      color: var(--text-main);
    }

    .dias-grid {
      display: grid;
      grid-template-columns: 350px 1fr;
      gap: 2rem;
      align-items: flex-start;
    }

    .dias-form-section {
      background: #ffffff;
      padding-right: 20px;
      border-right: 1px solid var(--border);
    }

    .dias-list-section {
      background: #ffffff;
    }

    .dias-section-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 1.25rem;
      color: var(--text-main);
      padding-bottom: 10px;
      border-bottom: 2px solid #f1f5f9;
    }

    .dias-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.375rem;
    }

    .form-group label {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-main);
    }

    input:not([type="radio"]), select, .dias-input {
      width: 100%;
      padding: 0.625rem 0.75rem;
      font-size: 0.95rem;
      border: 1px solid var(--input-border);
      border-radius: 0.5rem;
      background-color: #fff;
      transition: all 0.2s;
      font-family: inherit;
    }

    input:not([type="radio"]):focus, select:focus, .dias-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
    }

    .radio-group {
      display: flex;
      gap: 15px;
      margin-top: 5px;
    }

    .radio-label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .radio-label input[type="radio"] {
      width: 1.1em;
      height: 1.1em;
      accent-color: var(--primary);
    }

    .form-actions {
      margin-top: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .btn-primary {
      width: 100%;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 0.5rem;
      padding: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-primary:hover {
      background: var(--primary-hover);
    }

    .btn-secondary {
      width: 100%;
      background: #fff;
      color: var(--text-muted);
      border: 1px solid var(--input-border);
      border-radius: 0.5rem;
      padding: 0.75rem;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-secondary:hover {
      background: #f8fafc;
      color: var(--text-main);
    }

    .table-responsive {
      overflow-x: auto;
    }

    .dias-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      font-size: 0.9rem;
    }

    .dias-table thead th {
      background: #f8fafc;
      color: var(--text-muted);
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.05em;
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      text-align: left;
    }

    .dias-table tbody td {
      padding: 1rem;
      border-bottom: 1px solid #f1f5f9;
      color: var(--text-main);
      vertical-align: middle;
    }

    .dias-table tbody tr:hover {
      background-color: #f8fafc;
    }

    .badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .badge-FERIADO { background: #fee2e2; color: #991b1b; }
    .badge-VACACIONES { background: #dbeafe; color: #1e40af; }
    .badge-AUSENCIA { background: #fef3c7; color: #92400e; }

    .dias-actions {
      display: flex;
      gap: 8px;
    }

    .action-btn {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--border);
      background: white;
      border-radius: 6px;
      cursor: pointer;
      color: var(--text-muted);
      transition: all 0.2s;
    }

    .edit-btn:hover { border-color: var(--primary); color: var(--primary); background: #eff6ff; }
    .delete-btn:hover { border-color: #ef4444; color: #ef4444; background: #fef2f2; }

    .dias-empty {
      text-align: center;
      padding: 2rem;
      color: var(--text-muted);
      font-style: italic;
    }

    .dias-alert {
      padding: 1rem;
      border-radius: 0.5rem;
      margin-bottom: 1.5rem;
      font-weight: 500;
      font-size: 0.9rem;
    }
    .dias-alert-success { background: #f0fdf4; color: #166534; border: 1px solid #bbf7d0; }
    .dias-alert-error { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }

    @media (max-width: 1024px) {
      .dias-grid {
        grid-template-columns: 1fr;
        gap: 2rem;
      }
      .dias-form-section {
        border-right: none;
        border-bottom: 1px solid var(--border);
        padding-right: 0;
        padding-bottom: 2rem;
      }
    }