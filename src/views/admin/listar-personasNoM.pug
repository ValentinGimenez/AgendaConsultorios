extends ../layout

block content
  .people-list-container
    h1.page-title Lista de Personas

    .table-responsive
      table#tablaPersonas.display
        thead
          tr
            th ID
            th Nombre y Apellido
            th Correo
            th DNI
            th Teléfono
            th Acciones 
        tbody
          each persona in personas
            tr
              td= persona.ID
              td= persona.nombre + ' ' + persona.apellido
              td= persona.mail
              td= persona.dni
              td= persona.telefono
              td 
                a.btn.btn-primary(href=`/medico/registrar/${persona.ID}`) Registrar Médico 

block scripts
  script(src='https://code.jquery.com/jquery-3.7.1.min.js')
  script(src='https://cdn.datatables.net/2.1.8/js/dataTables.min.js')
  script.
    $(document).ready(function () {
      $('#tablaPersonas').DataTable({
        dom: 'frtip', 
        order: [[0, 'asc']], 
        paging: false,
        language: {
          info: "", 
          search: "Buscar personas",
        }
      });

      $('a[href^="/medico/registrar/"]').on('click', async function(event) {
        event.preventDefault();
        
        const idPersona = $(this).attr('href').split('/').pop();
        const row = $(this).closest('tr');
        const nombre = row.find('td:eq(1)').text().split(' ')[0];
        const apellido = row.find('td:eq(1)').text().split(' ').slice(1).join(' ');
        const dni = row.find('td:eq(3)').text();
        const mail = row.find('td:eq(2)').text();
        const telefono = row.find('td:eq(4)').text(); 

        try {
          const response = await fetch('/medico', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              nombre,
              apellido,
              dni,
              mail,
              telefono,
              idPersona
            }),
          });

          if (response.ok) {
            alert('Médico registrado exitosamente');
            location.reload(); 
          } else {
            const errorData = await response.json();
            alert('Error al registrar el médico: ' + (errorData.message || 'Error desconocido')); 
          }
        } catch (error) {
          console.error('Error al enviar el formulario:', error);
          alert('Error al enviar el formulario.');
        }
      });
    });

  block styles
    style.
      .people-list-container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 1rem;
      }

      .page-title {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 2rem;
      }

      .table-responsive {
        overflow-x: auto;
      }

      #tablaPersonas {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
      }

      #tablaPersonas th,
      #tablaPersonas td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      #tablaPersonas th {
        background-color: #f2f2f2;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.9rem;
        color: #2c3e50;
      }

      #tablaPersonas tr:last-child td {
        border-bottom: none;
      }

      #tablaPersonas tbody tr:nth-child(even) {
        background-color: #f9f9f9;
      }

      #tablaPersonas tbody tr:hover {
        background-color: #e9e9e9;
      }

      .btn-primary {
        background-color: #3498db;
        color: white;
        padding: 8px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        text-decoration: none;
      }

      .btn-primary:hover {
        background-color: #2980b9;
      }

      .table-top,
      .table-bottom {
        margin: 1rem 0;
      }

      .dataTables_filter input {
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-left: 10px;
      }

      .dataTables_paginate {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }

      .dataTables_paginate .paginate_button {
        padding: 5px 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .dataTables_paginate .paginate_button:hover {
        background-color: #f2f2f2;
      }

      .dataTables_paginate .paginate_button.current {
        background-color: #3498db;
        color: white;
        border-color: #3498db;
      }

      @media (max-width: 768px) {
        #tablaPersonas th,
        #tablaPersonas td {
          padding: 8px;
        }

        .btn-primary {
          padding: 6px 10px;
          font-size: 0.9rem;
        }
      }